var VimeoUpload=function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var i={};return t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=11)}([function(e,t,i){"use strict";t.__esModule=!0;var n=i(7),r=i(5),o=i(8),s=function(){function e(e){this.timerService=e}return e.prototype.send=function(e,t){var i=this;return void 0===t&&(t=!1),new Promise(function(n,r){var s=new XMLHttpRequest,c=i.timerService.create();s.open(e.method,e.url,!0),e.headers.forEach(function(e){return s.setRequestHeader(e.title,e.value)}),window.addEventListener("uploadaborted",function(){s.abort()},!1),s.onload=function(){var e=new Date;c.end=e,c.done=!0;var t=null;try{t=JSON.parse(s.response)}catch(e){t=s.response}var i=new o.Response(s.status,s.statusText,t);switch(!0){case s.status>=200&&s.status<300:n(i);break;case 308===s.status:i.range=s.getResponseHeader("Range"),n(i);break;default:r(i)}},s.onerror=function(){r(new o.Response(s.status,s.statusText,s.response||null))},t&&(i.timerService.save(c),s.upload.addEventListener("progress",function(e){if(e.lengthComputable){var t=Math.floor(e.loaded/e.total*100);c.percent=t,c.end=new Date}}));try{s.send(e.data)}catch(e){console.error("An error occured while sending.",e)}})},e.CreateRequest=function(e,t,i,o){void 0===i&&(i=null),void 0===o&&(o=null);var s=[];for(var c in o)o.hasOwnProperty(c)&&s.push(new r.Header(c,o[c]));return new n.Request(e,t,i,s)},e}();t.HttpService=s},function(e,t,i){"use strict";t.__esModule=!0,t.DEFAULT_VALUES={preferredUploadDuration:30,chunkSize:1048576,token:"TOKEN_STRING_HERE",supportedFiles:["mov","mpeg4","mp4","avi","wmv","mpegps","flv","3gpp","webm"],name:"",description:"",file:null,upgrade_to_1080:!1,timeInterval:150},t.DEFAULT_EVENTS={chunkprogresschanged:function(e){return console.log("Default: Chunk Progress Update: "+e.detail+"/100")},totalprogresschanged:function(e){return console.log("Default: Total Progress Update: "+e.detail+"/100")},estimatedtimechanged:function(e){return console.log("Default: Estimated Time Update: "+e.detail)},estimatedchunktimechanged:function(e){return console.log("Default: Estimated Chunk Time Update: "+e.detail)},estimateduploadspeedchanged:function(e){return console.log("Default: Estimated Upload Speed Changed: "+e.detail+" mb/s")},uploadaborted:function(e){return console.log("Default: Upload aborted detected.")}}},function(e,t,i){"use strict";t.__esModule=!0;var n=i(1),r=function(){function e(){}return e.Add=function(e,t){window.addEventListener(e,t,!1)},e.Remove=function(e,t){window.removeEventListener(e,t,!1)},e.Dispatch=function(e,t){void 0===t&&(t=null);var i=new CustomEvent(e,{detail:t});window.dispatchEvent(i)},e.Exists=function(e){return n.DEFAULT_EVENTS.hasOwnProperty(e)},e.GetDefault=function(e){return n.DEFAULT_EVENTS[e]},e}();t.EventService=r},function(e,t,i){"use strict";t.__esModule=!0;var n=i(15),r=i(13),o=i(17),s=i(1),c=i(2),a=i(18),u=i(14),d=i(16),l=i(0),h=function(){function e(e){void 0===e&&(e={});for(var t in e)if(e.hasOwnProperty(t))switch(!0){case s.DEFAULT_VALUES.hasOwnProperty(t):s.DEFAULT_VALUES[t]=e[t];break;default:console.warn("Unrecognized property: "+t)}this.timerService=new d.TimerService(s.DEFAULT_VALUES.timeInterval,this.chunkService),this.httpService=new l.HttpService(this.timerService),this.ticketService=new n.TicketService(s.DEFAULT_VALUES.token,this.httpService),this.mediaService=new u.MediaService(s.DEFAULT_VALUES),this.chunkService=new r.ChunkService(this.mediaService,s.DEFAULT_VALUES.preferredUploadDuration,s.DEFAULT_VALUES.chunkSize),this.uploadService=new o.UploadService(this.mediaService,this.ticketService,this.httpService),this.validatorService=new a.ValidatorService(s.DEFAULT_VALUES.supportedFiles)}return e.prototype.start=function(e){var t=this;void 0===e&&(e={}),this.mediaService.setData(e),e.token&&(this.ticketService.token=s.DEFAULT_VALUES.token=e.token),this.validatorService.isSupported(this.mediaService.media.file)&&this.ticketService.open().then(function(e){console.log(e),t.ticketService.save(e),t.timerService.start(),t.process()}).catch(function(e){console.log("Error occured while generating ticket. "+e)})},e.prototype.process=function(){var e=this;console.log("Processing");var t=this.chunkService.create();console.log(t.content,t.contentRange),this.uploadService.send(t).then(function(t){console.log("DURATION "+e.timerService.getChunkUploadDuration()),e.chunkService.updateSize(e.timerService.getChunkUploadDuration()),e.check()}).catch(function(e){console.error("Error sending chunk",e)})},e.prototype.check=function(){var e=this;this.uploadService.getRange().then(function(t){switch(t.status){case 308:if(console.log("New range "+t.range),e.chunkService.updateOffset(t.range),c.EventService.Dispatch("totalprogresschanged",e.chunkService.getPercent()),e.chunkService.isDone())return void e.done();e.process();break;case 200:e.ticketService.close().then(function(e){console.log(e)}).catch(function(e){console.log(e)});break;default:console.warn("Unrecognized status code ("+t.status+") for chunk range.")}}).catch(function(e){console.error("Error getting chunk range",e)})},e.prototype.done=function(){this.ticketService.close().then(function(e){console.log("Delete success:",e)}).catch(function(e){console.warn("Delete failed:",e)})},e.prototype.abort=function(){c.EventService.Dispatch("uploadaborted"),this.done()},e.prototype.on=function(e,t){void 0===t&&(t=null),c.EventService.Exists(e)&&(null===t&&(t=c.EventService.GetDefault(e)),c.EventService.Add(e,t))},e.prototype.off=function(e,t){void 0===t&&(t=null),c.EventService.Exists(e)&&(null===t&&(t=c.EventService.GetDefault(e)),c.EventService.Remove(e,t))},e}();t.App=h},function(e,t,i){"use strict";t.__esModule=!0;var n=function(){function e(e,t){this.content=e,this.contentRange=t}return e}();t.Chunk=n},function(e,t,i){"use strict";t.__esModule=!0;var n=function(){function e(e,t){this.title=e,this.value=t}return e}();t.Header=n},function(e,t,i){"use strict";t.__esModule=!0;var n=function(){function e(e,t,i,n){void 0===e&&(e=""),void 0===t&&(t=""),void 0===i&&(i=null),void 0===n&&(n=!1),this.name=e,this.description=t,this.file=i,this.upgrade_to_1080=n}return e}();t.Media=n},function(e,t,i){"use strict";t.__esModule=!0;var n=function(){function e(e,t,i,n){void 0===i&&(i=null),void 0===n&&(n=[]),this.method=e,this.url=t,this.data=i,this.headers=n}return e}();t.Request=n},function(e,t,i){"use strict";t.__esModule=!0;var n=function(){function e(e,t,i){void 0===i&&(i=null),this.status=e,this.statusText=t,this.data=i,this.range=null,this.duration=-1}return e}();t.Response=n},function(e,t,i){"use strict";t.__esModule=!0;var n=function(){function e(e,t,i,n,r){this.uploadLinkSecure=e,this.ticketId=t,this.uploadLink=i,this.completeUri=n,this.user=r}return e}();t.Ticket=n},function(e,t,i){"use strict";t.__esModule=!0;var n=function(){function e(e,t,i,n){void 0===i&&(i=0),void 0===n&&(n=!1),this.start=e,this.end=t,this.percent=i,this.done=n}return e}();t.TimeData=n},function(e,t,i){"use strict";t.__esModule=!0;var e,n=i(3);e.exports=n.App},function(e,t,i){"use strict";t.__esModule=!0,t.VIMEO_ROUTES={DEFAULT:function(e){return void 0===e&&(e=""),"https://api.vimeo.com"+e},TICKET:function(){return t.VIMEO_ROUTES.DEFAULT()+"/me/videos"}}},function(e,t,i){"use strict";t.__esModule=!0;var n=i(4),r=function(){function e(e,t,i,n){void 0===n&&(n=0),this.mediaService=e,this.preferredUploadDuration=t,this.size=i,this.offset=n}return e.prototype.updateSize=function(e){console.log(this.size,e,this.preferredUploadDuration),this.size=Math.floor(this.size*this.preferredUploadDuration/e)},e.prototype.create=function(){var e=Math.min(this.offset+this.size,this.mediaService.media.file.size),t=this.mediaService.media.file.slice(this.offset,e);return new n.Chunk(t,"bytes "+this.offset+"-"+e+"/"+this.mediaService.media.file.size)},e.prototype.updateOffset=function(e){this.offset=parseInt(e.match(/\d+/g).pop(),10)+1},e.prototype.getPercent=function(){return Math.floor(this.offset/this.mediaService.media.file.size*100)},e.prototype.isDone=function(){return this.offset>=this.mediaService.media.file.size},e}();t.ChunkService=r},function(e,t,i){"use strict";t.__esModule=!0;var n=i(6),r=function(){function e(e){this.options=e,this.media=new n.Media,this.setData(e)}return e.prototype.setData=function(e){for(var t in e)e.hasOwnProperty(t)&&this.media.hasOwnProperty(t)&&(this.media[t]=e[t]);null!==this.media.file&&""===this.media.name&&(this.media.name=this.media.file.name)},e}();t.MediaService=r},function(e,t,i){"use strict";t.__esModule=!0;var n=i(0),r=i(9),o=i(12),s=function(){function e(e,t){this.token=e,this.httpService=t}return e.prototype.open=function(){var e=n.HttpService.CreateRequest("POST",o.VIMEO_ROUTES.TICKET(),JSON.stringify({type:"streaming"}),{Authorization:"Bearer "+this.token,"Content-Type":"application/json"});return this.httpService.send(e)},e.prototype.save=function(e){this.ticket=new r.Ticket(e.data.upload_link_secure,e.data.ticket_id,e.data.upload_link,e.data.complete_uri,e.data.user)},e.prototype.close=function(){var e=n.HttpService.CreateRequest("DELETE",o.VIMEO_ROUTES.DEFAULT(this.ticket.completeUri),null,{Authorization:"Bearer "+this.token});return this.httpService.send(e)},e}();t.TicketService=s},function(e,t,i){"use strict";t.__esModule=!0;var n=i(2),r=i(19),o=i(10),s=function(){function e(e,t){this.timeInterval=e,this.chunkService=t,this.si=-1}return e.prototype.start=function(){this.totalTimeData=this.create(),this.startInterval()},e.prototype.create=function(){var e=new Date;return new o.TimeData(e,e)},e.prototype.save=function(e){this.chunkTimeData=e},e.prototype.estimateTimeLeft=function(e,t){void 0===t&&(t=0);var i=Math.floor((new Date).getTime()-e.start.getTime());return Math.floor(100*i/e.percent)-i-t},e.prototype.startInterval=function(){var e=this;this.si>-1&&clearInterval(this.si),this.si=setInterval(function(){var t=!e.chunkTimeData||e.chunkTimeData.done?0:e.estimateTimeLeft(e.chunkTimeData),i=r.TimeUtil.TimeToSeconds(t),o=e.estimateTimeLeft(e.totalTimeData,t),s=r.TimeUtil.TimeToSeconds(o);n.EventService.Dispatch("estimatedtimechanged",{seconds:s,timeFormat:r.TimeUtil.TimeToString(o)}),n.EventService.Dispatch("estimatedchunktimechanged",{seconds:i,timeFormat:r.TimeUtil.TimeToString(t)}),n.EventService.Dispatch("chunkprogresschanged",e.chunkTimeData.percent),n.EventService.Dispatch("estimateduploadspeedchanged",e.chunkService.size/i)},this.timeInterval)},e.prototype.getChunkUploadDuration=function(){return r.TimeUtil.TimeToSeconds(this.chunkTimeData.end.getTime()-this.chunkTimeData.start.getTime())},e}();t.TimerService=s},function(e,t,i){"use strict";t.__esModule=!0;var n=i(0),r=function(){function e(e,t,i){this.mediaService=e,this.ticketService=t,this.httpService=i}return e.prototype.send=function(e){console.log(e.content,e.contentRange);var t=n.HttpService.CreateRequest("PUT",this.ticketService.ticket.uploadLinkSecure,e.content,{"Content-Type":this.mediaService.media.file.type,"Content-Range":e.contentRange});return this.httpService.send(t,!0)},e.prototype.getRange=function(){var e=n.HttpService.CreateRequest("PUT",this.ticketService.ticket.uploadLinkSecure,null,{"Content-Type":this.mediaService.media.file.type,"Content-Range":"bytes */* "});return this.httpService.send(e)},e}();t.UploadService=r},function(e,t,i){"use strict";t.__esModule=!0;var n=function(){function e(e){this.supportedFiles=e}return e.prototype.isSupported=function(e){var t=e.type;if(-1===t.indexOf("/"))return console.warn("Wrong type found ("+t+")."),!1;var i=t.split("/");return"video"!==i[0]?(console.warn("Only videos are supported, "+t+" given."),!1):this.supportedFiles.includes(i[1])},e}();t.ValidatorService=n},function(e,t,i){"use strict";t.__esModule=!0;var n=function(){function e(){}return e.TimeToSeconds=function(e){return e/1e3},e.TimeToString=function(e){var t=new Date(null);return t.setTime(e),t.toISOString().substr(11,8)},e}();t.TimeUtil=n}]);