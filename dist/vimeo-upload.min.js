var VimeoUpload=function(t){function e(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var i={};return e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=11)}([function(t,e,i){"use strict";e.__esModule=!0;var n=i(7),o=i(5),r=i(8),a=function(){function t(t){this.statService=t}return t.prototype.send=function(t,e){var i=this;return void 0===e&&(e=!1),new Promise(function(n,o){var a=new XMLHttpRequest,s=i.statService.create();a.open(t.method,t.url,!0),t.headers.forEach(function(t){return a.setRequestHeader(t.title,t.value)}),window.addEventListener("uploadaborted",function(){a.abort()},!1),a.onload=function(){var t=new Date;s.end=t,s.done=!0;var e=null;try{e=JSON.parse(a.response)}catch(t){e=a.response}var i=new r.Response(a.status,a.statusText,e);switch(!0){case a.status>=200&&a.status<300:n(i);break;case 308===a.status:i.range=a.getResponseHeader("Range"),n(i);break;default:o(i)}},a.onerror=function(){o(new r.Response(a.status,a.statusText,a.response||null))},e&&(i.statService.save(s),a.upload.addEventListener("progress",function(t){t.lengthComputable&&(s.loaded=t.loaded,s.total=t.total,s.end=new Date)}));try{a.send(t.data)}catch(t){console.error("An error occured while sending.",t)}})},t.CreateRequest=function(t,e,i,r){void 0===i&&(i=null),void 0===r&&(r=null);var a=[];for(var s in r)r.hasOwnProperty(s)&&a.push(new o.Header(s,r[s]));return new n.Request(t,e,i,a)},t}();e.HttpService=a},function(t,e,i){"use strict";e.__esModule=!0,e.DEFAULT_VALUES={preferredUploadDuration:20,chunkSize:1048576,token:"TOKEN_STRING_HERE",supportedFiles:["mov","mpeg4","mp4","avi","wmv","mpegps","flv","3gpp","webm"],name:"",description:"",file:null,upgrade_to_1080:!1,timeInterval:150},e.DEFAULT_EVENTS={chunkprogresschanged:function(t){return console.log("Default: Chunk Progress Update: "+t.detail+"/100")},totalprogresschanged:function(t){return console.log("Default: Total Progress Update: "+t.detail+"/100")},estimatedtimechanged:function(t){return console.log("Default: Estimated Time Update: "+t.detail)},estimatedchunktimechanged:function(t){return console.log("Default: Estimated Chunk Time Update: "+t.detail)},estimateduploadspeedchanged:function(t){return console.log("Default: Estimated Upload Speed Changed: "+t.detail+" mb/s")},uploadaborted:function(t){return console.log("Default: Upload aborted detected.")}}},function(t,e,i){"use strict";e.__esModule=!0;var n=i(1),o=function(){function t(){}return t.Add=function(t,e){window.addEventListener(t,e,!1)},t.Remove=function(t,e){window.removeEventListener(t,e,!1)},t.Dispatch=function(t,e){void 0===e&&(e=null);var i=new CustomEvent(t,{detail:e});window.dispatchEvent(i)},t.Exists=function(t){return n.DEFAULT_EVENTS.hasOwnProperty(t)},t.GetDefault=function(t){return n.DEFAULT_EVENTS[t]},t}();e.EventService=o},function(t,e,i){"use strict";e.__esModule=!0;var n=i(16),o=i(13),r=i(17),a=i(1),s=i(2),c=i(18),u=i(14),d=i(0),l=i(15),h=function(){function t(t){void 0===t&&(t={});for(var e in t)if(t.hasOwnProperty(e))switch(!0){case a.DEFAULT_VALUES.hasOwnProperty(e):a.DEFAULT_VALUES[e]=t[e];break;default:console.warn("Unrecognized property: "+e)}this.mediaService=new u.MediaService(a.DEFAULT_VALUES),this.chunkService=new o.ChunkService(this.mediaService,a.DEFAULT_VALUES.preferredUploadDuration,a.DEFAULT_VALUES.chunkSize),this.statService=new l.StatService(a.DEFAULT_VALUES.timeInterval,this.chunkService),this.httpService=new d.HttpService(this.statService),this.ticketService=new n.TicketService(a.DEFAULT_VALUES.token,this.httpService),this.uploadService=new r.UploadService(this.mediaService,this.ticketService,this.httpService),this.validatorService=new c.ValidatorService(a.DEFAULT_VALUES.supportedFiles)}return t.prototype.start=function(t){var e=this;void 0===t&&(t={}),this.mediaService.setData(t),t.token&&(this.ticketService.token=a.DEFAULT_VALUES.token=t.token),this.validatorService.isSupported(this.mediaService.media.file)&&this.ticketService.open().then(function(t){console.log(t),e.ticketService.save(t),e.statService.start(),e.process()}).catch(function(t){console.log("Error occured while generating ticket. "+t)})},t.prototype.process=function(){var t=this;console.log("Processing");var e=this.chunkService.create();console.log(e.content,e.contentRange),this.uploadService.send(e).then(function(e){t.chunkService.updateSize(t.statService.getChunkUploadDuration()),t.check()}).catch(function(t){console.error("Error sending chunk",t)})},t.prototype.check=function(){var t=this;this.uploadService.getRange().then(function(e){switch(e.status){case 308:if(console.log("New range "+e.range),t.chunkService.updateOffset(e.range),t.chunkService.isDone())return void t.done();t.process();break;case 200:t.ticketService.close().then(function(t){console.log(t)}).catch(function(t){console.log(t)});break;default:console.warn("Unrecognized status code ("+e.status+") for chunk range.")}}).catch(function(t){console.error("Error getting chunk range",t)})},t.prototype.done=function(){var t=this;this.statService.totalStatData.done=!0,this.ticketService.close().then(function(e){t.statService.stop(),console.log("Delete success:",e)}).catch(function(e){t.statService.stop(),console.warn("Delete failed:",e)})},t.prototype.abort=function(){s.EventService.Dispatch("uploadaborted"),this.done()},t.prototype.on=function(t,e){void 0===e&&(e=null),s.EventService.Exists(t)&&(null===e&&(e=s.EventService.GetDefault(t)),s.EventService.Add(t,e))},t.prototype.off=function(t,e){void 0===e&&(e=null),s.EventService.Exists(t)&&(null===e&&(e=s.EventService.GetDefault(t)),s.EventService.Remove(t,e))},t}();e.App=h},function(t,e,i){"use strict";e.__esModule=!0;var n=function(){function t(t,e){this.content=t,this.contentRange=e}return t}();e.Chunk=n},function(t,e,i){"use strict";e.__esModule=!0;var n=function(){function t(t,e){this.title=t,this.value=e}return t}();e.Header=n},function(t,e,i){"use strict";e.__esModule=!0;var n=function(){function t(t,e,i,n){void 0===t&&(t=""),void 0===e&&(e=""),void 0===i&&(i=null),void 0===n&&(n=!1),this.name=t,this.description=e,this.file=i,this.upgrade_to_1080=n}return t}();e.Media=n},function(t,e,i){"use strict";e.__esModule=!0;var n=function(){function t(t,e,i,n){void 0===i&&(i=null),void 0===n&&(n=[]),this.method=t,this.url=e,this.data=i,this.headers=n}return t}();e.Request=n},function(t,e,i){"use strict";e.__esModule=!0;var n=function(){function t(t,e,i){void 0===i&&(i=null),this.status=t,this.statusText=e,this.data=i,this.range=null,this.duration=-1}return t}();e.Response=n},function(t,e,i){"use strict";e.__esModule=!0;var n=function(){function t(t,e,i,n,o){void 0===i&&(i=0),void 0===n&&(n=0),void 0===o&&(o=!1),this.start=t,this.end=e,this.loaded=i,this.total=n,this.done=o}return t}();e.StatData=n},function(t,e,i){"use strict";e.__esModule=!0;var n=function(){function t(t,e,i,n,o){this.uploadLinkSecure=t,this.ticketId=e,this.uploadLink=i,this.completeUri=n,this.user=o}return t}();e.Ticket=n},function(t,e,i){"use strict";e.__esModule=!0;var t,n=i(3);t.exports=n.App},function(t,e,i){"use strict";e.__esModule=!0,e.VIMEO_ROUTES={DEFAULT:function(t){return void 0===t&&(t=""),"https://api.vimeo.com"+t},TICKET:function(){return e.VIMEO_ROUTES.DEFAULT()+"/me/videos"}}},function(t,e,i){"use strict";e.__esModule=!0;var n=i(4),o=function(){function t(t,e,i,n){void 0===n&&(n=0),this.mediaService=t,this.preferredUploadDuration=e,this.size=i,this.offset=n}return t.prototype.updateSize=function(t){var e=1;t/this.preferredUploadDuration<.5?(console.log("Adjusting"),e=.5):t/this.preferredUploadDuration>2&&(e=2),console.log("Upload duration",t),this.size=Math.floor(this.size*this.preferredUploadDuration/t*e)},t.prototype.create=function(){var t=Math.min(this.offset+this.size,this.mediaService.media.file.size);t-this.offset!==this.size&&this.updateSize(t-this.offset);var e=this.mediaService.media.file.slice(this.offset,t);return new n.Chunk(e,"bytes "+this.offset+"-"+t+"/"+this.mediaService.media.file.size)},t.prototype.updateOffset=function(t){this.offset=parseInt(t.match(/\d+/g).pop(),10)+1},t.prototype.isDone=function(){return this.offset>=this.mediaService.media.file.size},t}();e.ChunkService=o},function(t,e,i){"use strict";e.__esModule=!0;var n=i(6),o=function(){function t(t){this.options=t,this.media=new n.Media,this.setData(t)}return t.prototype.setData=function(t){for(var e in t)t.hasOwnProperty(e)&&this.media.hasOwnProperty(e)&&(this.media[e]=t[e]);null!==this.media.file&&""===this.media.name&&(this.media.name=this.media.file.name)},t}();e.MediaService=o},function(t,e,i){"use strict";e.__esModule=!0;var n=i(2),o=i(19),r=i(9),a=function(){function t(t,e){this.timeInterval=t,this.chunkService=e,this.si=-1,this.previousTotalPercent=0}return t.prototype.start=function(){this.totalStatData=this.create(!0),this.startInterval()},t.prototype.create=function(t){void 0===t&&(t=!1);var e=new Date,i=t?this.chunkService.mediaService.media.file.size:this.chunkService.size;return new r.StatData(e,e,0,i)},t.prototype.save=function(t){this.chunkStatData=t},t.prototype.estimateTimeLeft=function(t){var e=Math.floor((new Date).getTime()-t.start.getTime()),i=this.calculateRatio(t);return i>0?Math.floor(e*i):e},t.prototype.calculateRatio=function(t){return t.loaded/t.total},t.prototype.calculatePercent=function(t){return Math.floor(100*this.calculateRatio(t))},t.prototype.calculateUploadSpeed=function(t){return t>0?Math.floor(this.chunkStatData.total/t):0},t.prototype.updateTotal=function(){this.totalStatData.loaded+=this.chunkStatData.total},t.prototype.startInterval=function(){var t=this;this.si>-1&&this.stop(),this.si=setInterval(function(){var e=100;t.chunkStatData.done?(t.updateTotal(),t.chunkStatData.total=t.chunkStatData.loaded=0):e=t.calculatePercent(t.chunkStatData),t.totalStatData.end=t.chunkStatData.end,t.previousTotalPercent=Math.max(t.totalStatData.loaded+t.chunkStatData.loaded,t.previousTotalPercent);var i=t.calculatePercent(new r.StatData(t.totalStatData.start,t.totalStatData.end,t.previousTotalPercent,t.totalStatData.total)),a=!t.chunkStatData||t.chunkStatData.done?0:t.estimateTimeLeft(t.chunkStatData),s=o.TimeUtil.TimeToSeconds(a),c=t.estimateTimeLeft(t.totalStatData),u=o.TimeUtil.TimeToSeconds(c),d=t.calculateUploadSpeed(s);n.EventService.Dispatch("estimatedtimechanged",{seconds:u,timeFormat:o.TimeUtil.MilisecondsToString(c)}),n.EventService.Dispatch("estimatedchunktimechanged",{seconds:s,timeFormat:o.TimeUtil.MilisecondsToString(a)}),n.EventService.Dispatch("chunkprogresschanged",e),t.totalStatData.done&&(i=100),n.EventService.Dispatch("estimateduploadspeedchanged",d),n.EventService.Dispatch("totalprogresschanged",i)},this.timeInterval)},t.prototype.stop=function(){clearInterval(this.si)},t.prototype.getChunkUploadDuration=function(){return o.TimeUtil.TimeToSeconds(this.chunkStatData.end.getTime()-this.chunkStatData.start.getTime())},t}();e.StatService=a},function(t,e,i){"use strict";e.__esModule=!0;var n=i(0),o=i(10),r=i(12),a=function(){function t(t,e){this.token=t,this.httpService=e}return t.prototype.open=function(){var t=n.HttpService.CreateRequest("POST",r.VIMEO_ROUTES.TICKET(),JSON.stringify({type:"streaming"}),{Authorization:"Bearer "+this.token,"Content-Type":"application/json"});return this.httpService.send(t)},t.prototype.save=function(t){this.ticket=new o.Ticket(t.data.upload_link_secure,t.data.ticket_id,t.data.upload_link,t.data.complete_uri,t.data.user)},t.prototype.close=function(){var t=n.HttpService.CreateRequest("DELETE",r.VIMEO_ROUTES.DEFAULT(this.ticket.completeUri),null,{Authorization:"Bearer "+this.token});return this.httpService.send(t)},t}();e.TicketService=a},function(t,e,i){"use strict";e.__esModule=!0;var n=i(0),o=function(){function t(t,e,i){this.mediaService=t,this.ticketService=e,this.httpService=i}return t.prototype.send=function(t){console.log(t.content,t.contentRange);var e=n.HttpService.CreateRequest("PUT",this.ticketService.ticket.uploadLinkSecure,t.content,{"Content-Type":this.mediaService.media.file.type,"Content-Range":t.contentRange});return this.httpService.send(e,!0)},t.prototype.getRange=function(){var t=n.HttpService.CreateRequest("PUT",this.ticketService.ticket.uploadLinkSecure,null,{"Content-Type":this.mediaService.media.file.type,"Content-Range":"bytes */* "});return this.httpService.send(t)},t}();e.UploadService=o},function(t,e,i){"use strict";e.__esModule=!0;var n=function(){function t(t){this.supportedFiles=t}return t.prototype.isSupported=function(t){var e=t.type;if(-1===e.indexOf("/"))return console.warn("Wrong type found ("+e+")."),!1;var i=e.split("/");return"video"!==i[0]?(console.warn("Only videos are supported, "+e+" given."),!1):this.supportedFiles.includes(i[1])},t}();e.ValidatorService=n},function(t,e,i){"use strict";e.__esModule=!0;var n=function(){function t(){}return t.TimeToSeconds=function(t){return t/1e3},t.TimeToString=function(t){var e=new Date(null);return e.setTime(t),e.toISOString().substr(11,8)},t.MilisecondsToString=function(e){var i=t.TimeToSeconds(e),n=new Date(null);return n.setSeconds(i),n.toISOString().substr(11,8)},t}();e.TimeUtil=n}]);